<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
  <h1>Search Instagram!</h1>
  <input type='text' name='loc' placeholder='Search Location'>
    <button>Search</button>
  <div id="map-canvas"></div>
      <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
      <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">
    var latitude = -34.397;
    var longitude = 150.644;
    function initialize(latitude, longitude) {
      var mapOptions = {
        center: { lat: latitude, lng: longitude},
        zoom: 8
      };
      var map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);
    }
    google.maps.event.addDomListener(window, 'load', initialize(latitude, longitude));

    var button = document.querySelector('button');
    var input = document.querySelector('input');
    button.addEventListener('click', function() {
      fetch(input.value);
    })

    function fetch(location){
      var xhr = new XMLHttpRequest();

      xhr.addEventListener('load', function() {

        var insta = JSON.parse(xhr.response);
        latitude = insta['data'][0]['location']['latitude'];
        longitude = insta['data'][0]['location']['longitude'];
        initialize(latitude, longitude);
        
        for (var i = 0; i < insta['data'].length; i++) {
          // li.innerHTML = '<img src=\"' + insta['data'][i]['images']['low_resolution']['url'] + '\">';
          console.log(insta['data'][i]['location']['latitude'])
          var myLatlng = new google.maps.LatLng(insta['data'][i]['location']['latitude'], insta['data'][i]['location']['longitude']);
          var mapOptions = {
            zoom: 3,
            center: myLatlng
          }
          var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
          var image = insta['data'][i]['images']['low_resolution']['url']
          
          var marker = new google.maps.Marker({
          animation: google.maps.Animation.DROP,
          position: myLatlng,
          // icon: insta['data'][i]['images']['low_resolution']['url']
          });
          // marker.addEventListener('click', function(){
          //   marker.icon = image;
          // })
          marker.setMap(map);
        }
      });

    xhr.open('GET', '/photos?loc=' + location.split(' ').join('+'), true);
    xhr.send();
    }

    </script>
  </body>
</html>
